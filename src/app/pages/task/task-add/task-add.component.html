
	<customer-input [order]="order" [default]="order.customer"></customer-input>
	<ng-container *ngFor="let shipItem of order.ships">
		<mat-card [ngClass]="shipItem.addressId == order.ship.addressId ? 'ship-selected' : ''">
			
			<mat-card-header (click)="shipSelected(shipItem)">
				<mat-card-title><mat-icon aria-label="how_to_reg" class="ship-ico">how_to_reg</mat-icon>{{shipItem.name}}</mat-card-title>
				<mat-card-subtitle><mat-icon aria-label="gps_fixed" class="ship-ico">gps_fixed</mat-icon>{{shipItem.location}}</mat-card-subtitle>
				<mat-card-subtitle><mat-icon aria-label="call" class="ship-ico">call</mat-icon>{{shipItem.phone}}</mat-card-subtitle>
				<mat-card-subtitle><mat-icon aria-label="email" class="ship-ico">email</mat-icon>{{shipItem.email}}</mat-card-subtitle>
			</mat-card-header>
			<mat-card-actions>
				<button mat-button>Edit</button>
				<button mat-button>Delete</button>
			</mat-card-actions>
		</mat-card>
	</ng-container>

	<div [hidden]="order.ship.addressId">
		<mat-form-field>
				<input matInput [(ngModel)]="order.newShip.name" placeholder="Name">
			</mat-form-field>

		<mat-form-field>
			<input matInput [(ngModel)]="order.newShip.location" placeholder="Location">
		</mat-form-field>
		
		<mat-form-field>
			<input matInput [(ngModel)]="order.newShip.phone" placeholder="Phone">
		</mat-form-field>
		
		<mat-form-field>
			<input matInput [(ngModel)]="order.newShip.email" placeholder="Email">
		</mat-form-field>
	</div>

	<table mat-table [dataSource]="order.orderItems" class="mat-elevation-z8" *ngIf="products.length > 0">
		<!-- Item Column -->
		<ng-container matColumnDef="productName">
			<th mat-header-cell *matHeaderCellDef> Product </th>
			<td mat-cell *matCellDef="let orderItem">
				<product-input [options]="products" [orderItem]="orderItem" [default]="orderItem.product"></product-input>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<!-- Item Column -->
		<ng-container matColumnDef="productCode">
			<th mat-header-cell *matHeaderCellDef width="85px" class="pl-8"> Code </th>
			<td mat-cell *matCellDef="let orderItem" width="85px" class="pl-8">
				<span *ngIf="!invalid && orderItem.product">
					{{orderItem.product.productCode}}
				</span>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>
		
		<!-- quantity Column -->
		<ng-container matColumnDef="quantity">
			<th mat-header-cell *matHeaderCellDef  width="85px" class="text-number"> Quantity </th>
			<td mat-cell *matCellDef="let orderItem"  width="85px" class="text-number" (click)="editing.quantity[orderItem.index] = true">
				<span *ngIf="!invalid && orderItem.product && orderItem.product.unit && !editing.quantity[orderItem.index]">
					{{orderItem.quantity}} {{orderItem.product.unit.catalogName}}
				</span>
				<mat-form-field *ngIf="editing.quantity[orderItem.index]" class="change-adjusted">
					<input matInput [id]="'change-quantity-' + orderItem.index" [(ngModel)]="orderItem.quantity"
						(focusout)="editing.quantity[orderItem.index] = false" autocomplete="off">
				</mat-form-field>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<!-- price Column -->
		<ng-container matColumnDef="price">
			<th mat-header-cell *matHeaderCellDef width="85px"class="text-number"> Price </th>
			<td mat-cell *matCellDef="let orderItem" width="85px" class="text-number">
				<span *ngIf="!invalid && orderItem.product && orderItem.product.price">
					{{orderItem.product.price}}
				</span>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<!-- price Column -->
		<ng-container matColumnDef="itemTotal">
			<th mat-header-cell *matHeaderCellDef width="85px" class="text-number"> Item Total </th>
			<td mat-cell *matCellDef="let orderItem"  width="85px" class="text-number">
				<span *ngIf="!invalid && orderItem.product && orderItem.product.price">
					{{orderItem.product.price * orderItem.quantity}}
				</span>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<!-- adjusted Column -->
		<ng-container matColumnDef="adjusted">
			<th mat-header-cell *matHeaderCellDef width="85px" class="text-number"> Adjusted </th>
			<td mat-cell *matCellDef="let orderItem" width="85px"class="text-number" (click)="editing.adjusted[orderItem.index] = true">
				<span *ngIf="!invalid && orderItem.product && !editing.adjusted[orderItem.index]">
					{{orderItem.adjusted}}
				</span>
				<mat-form-field *ngIf="editing.adjusted[orderItem.index]" class="change-adjusted">
					<input matInput [id]="'change-adjusted-' + orderItem.index" [(ngModel)]="orderItem.adjusted"
						(focusout)="editing.adjusted[orderItem.index] = false" autocomplete="off" autofocus >
				</mat-form-field>
			</td>
			<td mat-footer-cell *matFooterCellDef class="text-number">Total </td>
		</ng-container>

		<!-- net Column -->
		<ng-container matColumnDef="netTotal">
			<th mat-header-cell *matHeaderCellDef width="85px" class="text-number">Net Item Total</th>
			<td mat-cell *matCellDef="let orderItem" width="85px" class="text-number">
				<span *ngIf="!invalid && orderItem.product">
					<span *ngIf="orderItem.adjusted > 1 || orderItem.adjusted <= 0">
						{{orderItem.product.price * orderItem.quantity - orderItem.adjusted}}
					</span>
					<span *ngIf="orderItem.adjusted < 1 && orderItem.adjusted > 0">
						{{orderItem.product.price * orderItem.quantity * (1 - orderItem.adjusted)}}
					</span>
				</span>
			</td>
			<td mat-footer-cell *matFooterCellDef class="text-number"> {{getNetTotal()}} </td>
		</ng-container>

		<!-- Action Column -->
		<ng-container matColumnDef="action">
			<th mat-header-cell *matHeaderCellDef width="150px" class="pl-8">  </th>
			<td mat-cell *matCellDef="let orderItem; let last = last;" width="150px" class="pl-8">
				<button mat-icon-button color="warn" (click)="removeOrderItem(orderItem)" *ngIf="order.orderItems.length > 1">
					<mat-icon aria-label="clear">clear</mat-icon>
				</button>
				<button mat-icon-button color="primary" (click)="addOrderItem()" *ngIf="last == true">
					<mat-icon aria-label="add">add</mat-icon>
				</button>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>
		
		<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
		<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
		<tr mat-footer-row *matFooterRowDef="footerColumns"></tr>
	</table>

	<section class="example-section mt-2">
		<mat-slide-toggle
			class="example-margin"
			[color]="'primary'"
			[(ngModel)]="order.invoiceStatusChecked"
			[checked]="order.invoiceStatusChecked">
		  Invoice Status
		</mat-slide-toggle>
	</section>
	<mat-form-field class="example-full-width mt-2">
		<textarea matInput placeholder="Note" [(ngModel)]="order.note"></textarea>
	</mat-form-field>

	<div class="add-task-footer">
		<button mat-flat-button (click)="onNoClick()">Close</button>
		<button mat-flat-button color="primary" (click)="save()">Save</button>
	</div>
